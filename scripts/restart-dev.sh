#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Next.js dev —Å–µ—Ä–≤–µ—Ä–∞
# –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π .next/dev/lock

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Next.js dev —Å–µ—Ä–≤–µ—Ä–∞..."

# –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Next.js
echo "‚èπÔ∏è  –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Next.js..."
pkill -9 -f "next dev" 2>/dev/null
pkill -9 -f "next" 2>/dev/null
pkill -9 -f "node.*knowflow" 2>/dev/null

# –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç—ã
echo "üîì –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ 3000-3001..."
lsof -ti:3000,3001 2>/dev/null | xargs kill -9 2>/dev/null

# –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –∫–µ—à
echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –∫–µ—à–∞..."
find .next -name "*lock*" -type f -delete 2>/dev/null
rm -rf .next/dev 2>/dev/null

# –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
sleep 3

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo "üöÄ –ó–∞–ø—É—Å–∫ Next.js dev —Å–µ—Ä–≤–µ—Ä–∞..."
npm run dev

